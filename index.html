<html>
<head>
<title>Kanban Board</title>
</head>
<body>
<center>
    <h1>Kanban Board</h1>
    <!-- <canvas id="kanban_canvas" width="1200" height="600"></canvas>
    <script type="text/javascript" src="draw_canvas.js">
    </script><br> -->
    <!--TODO: standardize event structure, use Python to access sqlite, organize events -->
    <script>
// Make functions that deal with communicating with the server
function getTable() {
    if (window.XMLHttpRequest) {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
    } else {
        // code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            document.getElementById("board").innerHTML = xmlhttp.responseText;
        }
    };
    xmlhttp.open("GET", "cgi-bin/event_data.py", true);
    xmlhttp.send();
}
getTable();
function addEvent() {
    if (window.XMLHttpRequest) {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
    } else {
        // code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            document.getElementById("board").innerHTML = xmlhttp.responseText;
        }
    };
    var ids = ['date', 'column', 'title', 'description'];
    var vals = {'date': '', 'column': '', 'title': '', 'description': ''};
    for (var i = 0; i < ids.length; i++) {
        vals[ids[i]] = document.getElementById(ids[i]).value;
    }
    xmlhttp.open("POST", "cgi-bin/event_data.py", true);
    xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xmlhttp.send("date="+vals['date']+"&column="+vals['column']+"&title="+vals['title']+"&description="+vals['description']+"&addEvent=True");
    document.getElementById('title').value = '';
    document.getElementById('description').value = '';
    document.getElementById('date').setAttribute('value', new Date().toJSON().slice(0, 10));
}
var orig = '';
function edit(id) {
    var elem = document.getElementById(id);
    orig = elem.innerHTML;
    elem.removeAttribute('onclick');
    var data = elem.getAttribute('name');
    var col = data.split('|')[0]
    var cols = ['do_pool', 'longterm', 'high_priority', 'doing', 'done'];
    var col_names = ['Do Pool', 'Longterm', 'High Priority', 'Doing', 'Done'];
    var modifier = '<div style="text-align:right"><b onclick="deleteEvent(\'' + data + '\')">X</b></div>';
    modifier += 'Move:<select id=\'change_select\' onfocusout="changeColumn(\'' + data + '\')">';
    for (var i = 0; i < cols.length; i++) {
        if (col != cols[i]) {
            modifier += '<option value="'+cols[i]+'">'+col_names[i]+'</option>';
        }
    }
    modifier += '</select>';
    modifier += '<br>';
    modifier += '<center><input type="button" value="Cancel" onclick="cancel(\'' + id + '\')"></center>';
    elem.innerHTML = modifier;
}
function deleteEvent(data) {
    if (window.XMLHttpRequest) {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
    } else {
        // code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            document.getElementById("board").innerHTML = xmlhttp.responseText;
        }
    };
    data = data.split('|');
    xmlhttp.open("POST", "cgi-bin/event_data.py", true);
    xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xmlhttp.send("date="+data[1]+"&column="+data[0]+"&title="+data[2]+"&description="+data[3]+"&deleteEvent=True");
}
function changeColumn(data) {
    if (window.XMLHttpRequest) {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
    } else {
        // code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            document.getElementById("board").innerHTML = xmlhttp.responseText;
        }
    };
    var newCol = document.getElementById('change_select').value;
    data = data.split('|');
    xmlhttp.open("POST", "cgi-bin/event_data.py", true);
    xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xmlhttp.send("date="+data[1]+"&column="+data[0]+"&title="+data[2]+"&description="+data[3]+"&deleteEvent=True");

    setTimeout(function(){xmlhttp.open("POST", "cgi-bin/event_data.py", true);
    xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xmlhttp.send("date="+data[1]+"&column="+newCol+"&title="+data[2]+"&description="+data[3]+"&addEvent=True");}, 550);
}
function cancel(id) {
    var elem = document.getElementById(id);
    elem.innerHTML = orig;
    elem.setAttribute('onclick', 'edit("'+ id +'")');
    orig = '';
}
    </script>
    <div id='board'></div>

    <br>
    <br>
    <div id="footer_controls" style='padding-right:30%;padding-left:30%'>
        <div id='create_event' style='border:black solid 1px;background-color:lightgrey'>
            <h2>Create Event</h2>
            <form style='text-align:left;padding-left:25%'>
                Title:<input id='title' type='text' name='title' value='' maxlength='50'><br>
                Date:<input id='date' type='date' name='date' value=''><br>
                <script>
                    document.getElementById('date').setAttribute('value', new Date().toJSON().slice(0, 10));
                </script>
                Description:<textarea id='description' name='description' value='' rows='2' cols='50'></textarea><br>
                Column:<select id='column'>
                    <option value='do_pool'>Do Pool</option>
                    <option value='longterm'>Longterm</option>
                    <option value='high_priority'>High Priority</option>
                    <option value='doing'>Doing</option>
                    <option value='done'>Done</option>
                </select><br>
                <input type='button' value='Submit' onclick='addEvent()'>
            </form>
        </div>
    </div>
</center>
</body>
</html>
